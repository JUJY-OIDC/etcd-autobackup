apiVersion: batch/v1
kind: Job
metadata:
  name: oci-etcd-backup-job
spec:
  ttlSecondsAfterFinished: 600
  template:
    spec:
      securityContext: #root 권한
        runAsUser: 0
      containers:
      - name: etcd-backup
        image: na3150/jujy-etcd-custom:latest
        command: ["sh", "/scripts/test.sh"]
        volumeMounts:
        - name: script-volume
          mountPath: /scripts
        - name: pv-cert
          mountPath: /cert
        - name: pv-oci-key
          mountPath: /oci-key
      restartPolicy: Never
      volumes:
      - name: script-volume
        configMap:
          name: etcd-backup-configmap-oci
      - name : pv-cert
        persistentVolumeClaim:
          claimName: pvc-cert
      - name : pv-oci-key
        persistentVolumeClaim:
          claimName: pvc-oci-key
  backoffLimit: 3